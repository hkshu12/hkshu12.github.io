---
title: 操作系统问题归档
tags: [OperatingSystem, Q&A]
mathjax: false
date: 2019-11-14 15:02:29
categories: Operating System
---

操作系统部分问答题归档整理-Part 1

<!-- more -->

## 1. 什么是实模式，什么是保护模式？

1. 实模式就是用基地址加偏移量就可以直接拿到物理地址的模式。

   - 缺点：实模式非常不安全。

2. 保护模式就是不能直接拿到物理地址的模式。
   - 需要进行地址转换
   - 从 80386 开始，是现代操作系统的主要模式

## 2. 什么是选择子？

1. 选择子共 16 位，放在段选择寄存器里
2. 低 2 位表示请求特权级
3. 第 3 位表示选择 GDT 方式还是 LDT 方式
4. 高 13 位表示在描述符表中的偏移（故描述符表的项数最多是 2 的 13 次方）

## 3. 什么是描述符？

保护模式下引入描述符来描述各种数据段，所有的描述符均为 8 个字节（0-7），由第 5 个字节说明描述符的类型。类型不同，描述符的结构也有所不同。

## 4. 什么是 GDT，什么是 LDT?

1. GDT：全局描述符表，是全局唯一的。存放一些公用的描述符、和包含各进程局部描述符表首地址的描述符。
2. LDT：局部描述符表，每个进程都可以有一个。存放本进程内使用的描述符。

## 5. 请分别说明 GDTR 和 LDTR 的结构。

1. GDTR：48 位寄存器，高 32 位放置 GDT 首地址，低 16 位放置 GDT 限长（限长决定了可寻址的大小，注意低 16 位放的不是选择子）
2. LDTR：16 位寄存器，放置一个特殊的选择子，用于查找当前进程的 LDT 首地址。

## 6. 请说明 GDT 直接查找物理地址的具体步骤。

1. 给出段选择子（放在段选择寄存器里）+偏移量

2. 若选择了 GDT 方式，则从 GDTR 获取 GDT 首地址，用段选择子中的 13 位做偏移，拿到 GDT 中的描述符

3. 如果合法且有权限，用描述符中的段首地址加上（1）中的偏移量找到物理地址。寻址结束。

{% asset_img GDT.png GDT %}

## 7. 请说明通过 LDT 查找物理地址的具体步骤。

1. 给出段选择子（放在段选择寄存器中）+偏移量
2. 若选择了 LDT 方式，则从 GDTR 获取 GDT 首地址，用 LDTR 中的偏移量做偏移，拿到 GDT 中的描述符 1
3. 从描述符 1 中获取 LDT 首地址，用段选择子中的 13 位做偏移，拿到 LDT 中的描述符 2
4. 如果合法且有权限，用描述符 2 中的段首地址加上（1）中的偏移量找到物理地址。寻址结束。

{% asset_img LDT.png LDT %}

## 8. 根目录区大小一定么？扇区号是多少？为什么？

不一定。FAT12 中一般从第 19 扇区开始。引导扇区占 1 扇区，2 个 FAT 表各占 9 扇区，故根目录区从 19 扇区开始。

根目录区大小根据引导扇区中根目录区文件数的最大值`BPB_RootEntCnt`而定。

## 9. 数据区第一个簇号是多少？为什么？

2 号簇。0 号和 1 号簇被系统保留并存储特殊标识内容。0 号 FAT 表项通常用来存放分区所在的介质类型；1 号 FAT 表项用来存储文件系统的肮脏标志，表明文件系统被非法卸载或者磁盘表面存在错误 。

本来序号为 0 和 1 的 FAT 表项应该对应于簇 0 和簇 1，但是由于这两个表项被设置成了固定值，簇 0 和簇 1 就没有存在的意义了，所以数据区就起始于簇 2。

## 10. FAT 表的作用？

文件分配表被划分为紧密排列的若干个表项，每个表项都与数据区中的一个簇相对应，而且表项的序号也是与簇号一一对应的。FAT 项的值代表文件的下一个簇号：

- 值大于或等于 0xFF8，表示当前簇已经是本文件的最后一个簇

- 值为 0xFF7，表示它是一个坏簇

## 11. 解释静态链接的过程。

静态链接就是在编译链接时直接将需要的执行代码拷贝到调用处。

静态链接的主要目的就是将多个目标文件合并，并处理各目标文件用到的外部符号，对外部符号重定位（调整地址），使程序能够正常执行。静态链接一般采用两步链接的方法。

**第一步，空间与地址分配。**扫描所有的输入目标文件，获得它们的各个段的长度、属性和位置，并且将输入目标文件中的符号表中所有的符号定义和符号引用收集起来，统一放到一个全局符号表。连接器获取所有输入目标文件的段长度后，将它们合并。

**第二步，符号解析与重定位。**使用上一步收集到的所有信息，读取输入目标文件中段的数据、重定位信息，并且进行符号解析与重定位、调整代码中的地址等。

## 12. 解释动态链接的过程。

使用这种方式的程序并不在一开始就完成动态链接，而是直到真正调用动态库代码时，载入程序才计算(被调用的那部分)动态代码的逻辑地址。

关于静态链接和动态链接，参见：[静态链接与动态链接在链接过程和文件结构上的区别](https://www.polarxiong.com/archives/静态链接与动态链接在链接过程和文件结构上的区别.html)

## 13. 静态链接相关 PPT 中为什么使用`ld`链接⽽不是`gcc`

因为没有依赖其他库，不需要`gcc`来告诉`ld`需要加入哪些依赖并调用`ld`，可直接调用`ld`。

在实际自己操作的时候用`ld`链接发生了报错，用`objdump -rd`命令查看`test.o`，发现`gcc`在编译过程中在里面加了一个函数`__stack_chk_fail`，查阅发现应该是`gcc`添加用于保护数组的(?)，在用`ld`命令链接时`ld`找不到该函数而出现问题，改用`gcc`后问题消除。

## 14. Linux 下可执行文件的虚拟地址空间默认从哪里开始分配。

> 32 位 Linux： 0x08048000
>
> 64 位 Linux： 0x00400000

## 15. BPB 指定字段的含义

```
BPB_BytsPerSec：每个扇区的字节数。
BPB_SecPerClus：每一簇的扇区数。
BPB_RsvdSecCnt：保留区的扇区数。（BOOT区）
BPB_NumFATs：FAT表的个数。
BPB_RootEntCnt：此字段指示根目录中32字节目录条目的数量。
BPB_TotSec16：总扇区数，在FAT12下，当扇区总数大于0xFFFF时，该值置为0，真实值由BPB_TotSec32指定。
BPB_Media：略。
BPB_FATSz16：一个FAT表所占的扇区数。
BPB_SecPerTrk：每个磁道的扇区数。
BPB_NumHeads：略。
BPB_HiddSec：隐藏扇区数。
BPB_TotSec32：总扇区数。
```
